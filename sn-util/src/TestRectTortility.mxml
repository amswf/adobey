<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/halo" minWidth="1024" minHeight="768"
			   creationComplete="init();">
	<fx:Script>
		<![CDATA[
			import com.snsoft.tortility.Quadrilateral4Point;
			import com.snsoft.tortility.RectTortility;
			import com.snsoft.util.images.ImageLoader;
			
			private var q4pe:Quadrilateral4Point = new Quadrilateral4Point(new Point(0,0),new Point(100,0),new Point(150,200),new Point(0,100));
			
			private var bmd:BitmapData = null;
			
			private var qp:Vector.<Point> = null;
			
			private var rt:RectTortility = new RectTortility();
			
			private function init():void{
				
				
				var v:Vector.<Point> = new Vector.<Point>();
				v.push(new Point(0,0),new Point(100,0),new Point(150,200),new Point(0,100),new Point(0,0));
				var shape:Shape = rt.drawFill(v);
				this.addChild(shape);
				qp = rt.findAllQuadrilateralPoints(shape);
				trace(qp.length);
				
				bmd = new BitmapData(shape.width,shape.height);
				bmd.setPixel32(0,0,0x000000);
				var bm:Bitmap = new Bitmap(bmd);
				bm.x = 200;
				bm.y = 10;
				this.addChild(bm);
				
				var loader:ImageLoader = new ImageLoader();
				loader.loadImage("test2.jpg");
				loader.addEventListener(Event.COMPLETE,handlerCmp);
			}
			
			private function handlerCmp(e:Event):void{
				var loader:ImageLoader = e.currentTarget as ImageLoader;
				var bmds:BitmapData = loader.bitmapData;
				
				var w:Number = bmds.width;
				var h:Number = bmds.height;
				
				var n:Number = qp.length; 
				for(var i:int = 0;i < n;i++){
					var p:Point = qp[i];
					var rateP:Point = rt.calculateSpace2LineRatePoint(p,q4pe.a,q4pe.d,q4pe.b,q4pe.c);
					 
					var ps:Point = new Point(w * rateP.x,h * rateP.y);
					
					var color:int = bmds.getPixel32(ps.x,ps.y);
					
					bmd.setPixel32(p.x,p.y,color);
				}
			}
		]]>
	</fx:Script>
</s:Application>
